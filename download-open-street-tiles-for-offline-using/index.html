<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download open street map tiles for offline usage - Egor Grishechko's Blog</title>
    <meta name="description" content="Instruction about downloading osm tiles for offile usage with C#">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">Egor Grishechko</a>
            <a href="/">Home</a>
        </nav>
    </header>

    <main>
        <article class="post">
            <header class="post-header">
                <h1>Download open street map tiles for offline usage</h1>
                <div class="post-meta">
                    <time datetime="2017-10-15">October 15, 2017</time>
                    <div class="tags"><span class="tag">dot.net</span> <span class="tag">open street map</span> <span class="tag">open source</span></div>
                </div>
            </header>

            <div class="post-content">
                <p>Hi everyone! Today I want to talk about downloading open street map tiles for offline usage.</p>
<p>I'll tell you about my journeys with them and give some links. Let's get started.</p>

<h2>Why did I need them?</h2>
One of my clients wanted to have a mobile app with offline maps. I was writing <code>API</code> for it.
Packing all arrays and adding maps to them were required because I needed to calculate final sizes of the arrays.

<h2>How offline maps works?</h2>
Let's think about earth's map like about table. We have rows and columns. So, every piece of the land can be represented with the cell in this table.
You can ask me - "But how zooms works? How can I zoom-in and zoom-out maps in applications. If we have only one table?" - My answer - we have different tables.
Each one for the level of zoom. For example in our application we used 12-15 levels.

I can't say about another map's systems, but <code>open street map</code> has 19 levels of <a href="http://wiki.openstreetmap.org/wiki/Zoom_levels">zoom</a>.
For example, <code>level 0</code> represents the whole world and <code>level 13</code> represents a village or town.

You need at least 2 or 3 zoom levels for getting application's map works well (correct zoom, small viewing issues, users' satisfaction :) )

<h2>Where can I grab them?</h2>

First of all, you need to understand that <code>OSM</code> is <code>OSS</code>. So, when you dowload data from their services, you will have to think about the consequences for all community. <a href="https://operations.osmfoundation.org/policies/tiles/">Official policy</a> tells you more about rules and don'ts.

<a href="http://wiki.openstreetmap.org/wiki/Tiles">This page</a> contains some useful info about tiles, such as list of servers, tools and so on.
As for me I was using official server with 3 subdomains:
<ul>
<li><a href="http://a.tile.openstreetmap.org"><code>a.tile.openstreetmap.org</code></a></li>
<li><a href="http://b.tile.openstreetmap.org"><code>b.tile.openstreetmap.org</code></a></li>
<li><a href="http://c.tile.openstreetmap.org"><code>c.tile.openstreetmap.org</code></a></li>
</ul>

<h2>Implementation</h2>

First of all you need coordinates of the area. 
I higly recommend <a href="http://tools.geofabrik.de/calc/">this tool</a>.

Let's imagine we need map of Saint-Petersburg for offile using.
There a few steps, which we need to do for getting them:

<h3>1. Getting coordinates<a name="getting-coordinates"></a></h3>

<ul>
<li>Open <a href="http://tools.geofabrik.de/calc/">tiles calculator and choose any area</a></li>
</ul>
<figure class="align-center" style="width: 422px; height: 391px">
	<a href="/assets/images/osm/choosing.png"><img src="/assets/images/osm/choosing.png"></a>
</figure>

<ul>
<li>Go to <code>CD</code> tab and notice <code>Osmosis Copy</code> field</li>
</ul>
<figure class="align-center" style="width: 284px; height: 494px">
	<a href="/assets/images/osm/coordinates.png"><img src="/assets/images/osm/coordinates.png"></a>
</figure>

<p>You need coordinates of two points. Bottom left and top right. You need them because of tiles presenting system.</p>
<p>As I said in the first paragraph, tiles are stored in the grid (table) format. For calculating numbers of tiles,</p>
<p>we need to know coordinates of the left bottom tile (number 1 on the picture) and top right tile. If we know them, we are able to calculate ranges.</p>
<figure class="align-center" style="width: 422px; height: 391px">
	<a href="/assets/images/osm/grid.png"><img src="/assets/images/osm/grid.png"></a>
</figure>

<h3>2. Writing code</h3>

<ul>
<li>Go to the github and see <a href="https://github.com/OsmSharp/tiles">this package</a>. It contains the great example of</li>
</ul>
<p>tiles abstraction writing with C# language.</p>

<ul>
<li>Create two tiles with coordinates, which you got in <a href="#getting-coordinates">getting coordinates section</a>.</li>
</ul>

<pre><code class="language-csharp">   var leftBottom = Tile.CreateAroundLocation(double.Parse(&quot;59.17&quot;), double.Parse(&quot;28.63&quot;), 14);
   var topRight = Tile.CreateAroundLocation(double.Parse(&quot;60.85&quot;), double.Parse(&quot;31.81&quot;), 14);
</code></pre>
<ul>
<li>Then create <code>TileRange</code> and be ready for dowloading tiles :)</li>
</ul>

<pre><code class="language-csharp">  //dirty, but obvious :)
  var minX = Math.Min(leftBottom.X, topRight.X);
  var maxX = Math.Max(leftBottom.X, topRight.X);

  var minY = Math.Min(leftBottom.Y, topRight.Y);
  var maxY = Math.Max(leftBottom.Y, topRight.Y);

  var tiles = new TileRange(minX, minY, maxX, maxY, zoom);
</code></pre>

<h3>3. Downloading tiles</h3>
Fow downloading tiles. You need to do <code>GET</code> requests in <code>{server}.tile.openstreetmap.org/{zoom}/{x}/{y}.png</code> format.
Where:
<ul>
<li><code>{server}</code> - symbol of server (a,b,c)</li>
<li><code>{zoom}</code> - level of zoom</li>
<li><code>{x}</code> - x position of the tile</li>
<li><code>{y}</code> - y postion of the tile</li>
</ul>

<pre><code class="language-csharp">    foreach(var tile in tiles){
      //only one server name is just for the example. It&#39;s not recommended to use only 1 server endpoint
      var endpointUrl = $&quot;http://a.tile.openstreetmap.org/14/{tile.X}/{tile.Y}.png&quot;
    }
</code></pre>

<h3>4. Example of downloading tiles</h3>
Example below is just my personal implementation and I don't force you to do it in the same way
<pre><code class="language-csharp">        private readonly string[] _serverEndpoints = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;};

        public async Task DownloadTiles(int cityId, TileRange range, int zoom)
        {
            var random = new Random();
            var maxDegreeOfParalellism = 2;
            await range.ParallelForEachAsync(async tile =&gt;
            {
                var url =
                    $&quot;http://{_serverEndpoints[random.Next(0, 2)]}.tile.openstreetmap.org/{zoom}/{tile.X}/{tile.Y}.png&quot;;
                var data = await _client.GetByteArrayAsync(url);

            }, maxDegreeOfParalellism);
        }
</code></pre>
<code>ParallelForEachAsync</code> available on <a href="https://github.com/tyrotoxin/AsyncEnumerable">github</a>.

<code>maxDegreeOfParalellism</code> equals two because of <a href="https://operations.osmfoundation.org/policies/tiles/">official policy</a>.

<h2>P.S.</h2>

I need to say again, that <code>OSM</code> is <code>OSS</code> project. This means that you shouldn't build software with massive calls to <code>OSM</code> endpoints. If you do this, your <code>IP</code> will be ban. If you need to serve a lot of client requests, you can create your own tiles server or use paid-solutions.

<h2>Conclusion</h2>

That's all. I'll be happy, It this article helps you.
            </div>
        </article>
    </main>

    <footer>
        <p>&copy; 2026 Egor Grishechko. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>